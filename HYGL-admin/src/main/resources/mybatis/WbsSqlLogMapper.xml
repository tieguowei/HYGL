<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.resale.background.mapper.WbsSqlLogMapper" >
  <resultMap id="BaseResultMap" type="com.resale.background.pojo.WbsSqlLog" >
    <result column="db" property="db" jdbcType="VARCHAR" />
    <result column="tid" property="tid" jdbcType="VARCHAR" />
    <result column="user" property="user" jdbcType="VARCHAR" />
    <result column="user_ip" property="userIp" jdbcType="VARCHAR" />
    <result column="sql_type" property="sqlType" jdbcType="VARCHAR" />
    <result column="fail" property="fail" jdbcType="VARCHAR" />
    <result column="check_rows" property="checkRows" jdbcType="VARCHAR" />
    <result column="update_rows" property="updateRows" jdbcType="VARCHAR" />
    <result column="latency" property="latency" jdbcType="VARCHAR" />
    <result column="ts" property="ts" jdbcType="VARCHAR" />
  </resultMap>
  <resultMap id="ResultMapWithBLOBs" type="com.resale.background.pojo.WbsSqlLog" extends="BaseResultMap" >
    <result column="log" property="log" jdbcType="LONGVARCHAR" />
  </resultMap>
  <sql id="Example_Where_Clause" >
    <where >
      <foreach collection="oredCriteria" item="criteria" separator="or" >
        <if test="criteria.valid" >
          <trim prefix="(" suffix=")" prefixOverrides="and" >
            <foreach collection="criteria.criteria" item="criterion" >
              <choose >
                <when test="criterion.noValue" >
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue" >
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue" >
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue" >
                  and ${criterion.condition}
                  <foreach collection="criterion.value" item="listItem" open="(" close=")" separator="," >
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Update_By_Example_Where_Clause" >
    <where >
      <foreach collection="example.oredCriteria" item="criteria" separator="or" >
        <if test="criteria.valid" >
          <trim prefix="(" suffix=")" prefixOverrides="and" >
            <foreach collection="criteria.criteria" item="criterion" >
              <choose >
                <when test="criterion.noValue" >
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue" >
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue" >
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue" >
                  and ${criterion.condition}
                  <foreach collection="criterion.value" item="listItem" open="(" close=")" separator="," >
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Base_Column_List" >
    db, tid, user, user_ip, sql_type, fail, check_rows, update_rows, latency, ts
  </sql>
  <sql id="Blob_Column_List" >
    log
  </sql>
  <select id="selectByExampleWithBLOBs" resultMap="ResultMapWithBLOBs" parameterType="com.resale.background.pojo.WbsSqlLogExample" >
    select
    <if test="distinct" >
      distinct
    </if>
    <include refid="Base_Column_List" />
    ,
    <include refid="Blob_Column_List" />
    from wbs_sql_log
    <if test="_parameter != null" >
      <include refid="Example_Where_Clause" />
    </if>
    <if test="orderByClause != null" >
      order by ${orderByClause}
    </if>
  </select>
  <select id="selectByExample" resultMap="BaseResultMap" parameterType="com.resale.background.pojo.WbsSqlLogExample" >
    select
    <if test="distinct" >
      distinct
    </if>
    <include refid="Base_Column_List" />
    from wbs_sql_log
    <if test="_parameter != null" >
      <include refid="Example_Where_Clause" />
    </if>
    <if test="orderByClause != null" >
      order by ${orderByClause}
    </if>
  </select>
  <delete id="deleteByExample" parameterType="com.resale.background.pojo.WbsSqlLogExample" >
    delete from wbs_sql_log
    <if test="_parameter != null" >
      <include refid="Example_Where_Clause" />
    </if>
  </delete>
  <insert id="insert" parameterType="com.resale.background.pojo.WbsSqlLog" >
    insert into wbs_sql_log (db, tid, user, 
      user_ip, sql_type, fail, 
      check_rows, update_rows, latency, 
      ts, log)
    values (#{db,jdbcType=VARCHAR}, #{tid,jdbcType=VARCHAR}, #{user,jdbcType=VARCHAR}, 
      #{userIp,jdbcType=VARCHAR}, #{sqlType,jdbcType=VARCHAR}, #{fail,jdbcType=VARCHAR}, 
      #{checkRows,jdbcType=VARCHAR}, #{updateRows,jdbcType=VARCHAR}, #{latency,jdbcType=VARCHAR}, 
      #{ts,jdbcType=VARCHAR}, #{log,jdbcType=LONGVARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.resale.background.pojo.WbsSqlLog" >
    insert into wbs_sql_log
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="db != null" >
        db,
      </if>
      <if test="tid != null" >
        tid,
      </if>
      <if test="user != null" >
        user,
      </if>
      <if test="userIp != null" >
        user_ip,
      </if>
      <if test="sqlType != null" >
        sql_type,
      </if>
      <if test="fail != null" >
        fail,
      </if>
      <if test="checkRows != null" >
        check_rows,
      </if>
      <if test="updateRows != null" >
        update_rows,
      </if>
      <if test="latency != null" >
        latency,
      </if>
      <if test="ts != null" >
        ts,
      </if>
      <if test="log != null" >
        log,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="db != null" >
        #{db,jdbcType=VARCHAR},
      </if>
      <if test="tid != null" >
        #{tid,jdbcType=VARCHAR},
      </if>
      <if test="user != null" >
        #{user,jdbcType=VARCHAR},
      </if>
      <if test="userIp != null" >
        #{userIp,jdbcType=VARCHAR},
      </if>
      <if test="sqlType != null" >
        #{sqlType,jdbcType=VARCHAR},
      </if>
      <if test="fail != null" >
        #{fail,jdbcType=VARCHAR},
      </if>
      <if test="checkRows != null" >
        #{checkRows,jdbcType=VARCHAR},
      </if>
      <if test="updateRows != null" >
        #{updateRows,jdbcType=VARCHAR},
      </if>
      <if test="latency != null" >
        #{latency,jdbcType=VARCHAR},
      </if>
      <if test="ts != null" >
        #{ts,jdbcType=VARCHAR},
      </if>
      <if test="log != null" >
        #{log,jdbcType=LONGVARCHAR},
      </if>
    </trim>
  </insert>
  <select id="countByExample" parameterType="com.resale.background.pojo.WbsSqlLogExample" resultType="java.lang.Integer" >
    select count(*) from wbs_sql_log
    <if test="_parameter != null" >
      <include refid="Example_Where_Clause" />
    </if>
  </select>
  <update id="updateByExampleSelective" parameterType="map" >
    update wbs_sql_log
    <set >
      <if test="record.db != null" >
        db = #{record.db,jdbcType=VARCHAR},
      </if>
      <if test="record.tid != null" >
        tid = #{record.tid,jdbcType=VARCHAR},
      </if>
      <if test="record.user != null" >
        user = #{record.user,jdbcType=VARCHAR},
      </if>
      <if test="record.userIp != null" >
        user_ip = #{record.userIp,jdbcType=VARCHAR},
      </if>
      <if test="record.sqlType != null" >
        sql_type = #{record.sqlType,jdbcType=VARCHAR},
      </if>
      <if test="record.fail != null" >
        fail = #{record.fail,jdbcType=VARCHAR},
      </if>
      <if test="record.checkRows != null" >
        check_rows = #{record.checkRows,jdbcType=VARCHAR},
      </if>
      <if test="record.updateRows != null" >
        update_rows = #{record.updateRows,jdbcType=VARCHAR},
      </if>
      <if test="record.latency != null" >
        latency = #{record.latency,jdbcType=VARCHAR},
      </if>
      <if test="record.ts != null" >
        ts = #{record.ts,jdbcType=VARCHAR},
      </if>
      <if test="record.log != null" >
        log = #{record.log,jdbcType=LONGVARCHAR},
      </if>
    </set>
    <if test="_parameter != null" >
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByExampleWithBLOBs" parameterType="map" >
    update wbs_sql_log
    set db = #{record.db,jdbcType=VARCHAR},
      tid = #{record.tid,jdbcType=VARCHAR},
      user = #{record.user,jdbcType=VARCHAR},
      user_ip = #{record.userIp,jdbcType=VARCHAR},
      sql_type = #{record.sqlType,jdbcType=VARCHAR},
      fail = #{record.fail,jdbcType=VARCHAR},
      check_rows = #{record.checkRows,jdbcType=VARCHAR},
      update_rows = #{record.updateRows,jdbcType=VARCHAR},
      latency = #{record.latency,jdbcType=VARCHAR},
      ts = #{record.ts,jdbcType=VARCHAR},
      log = #{record.log,jdbcType=LONGVARCHAR}
    <if test="_parameter != null" >
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByExample" parameterType="map" >
    update wbs_sql_log
    set db = #{record.db,jdbcType=VARCHAR},
      tid = #{record.tid,jdbcType=VARCHAR},
      user = #{record.user,jdbcType=VARCHAR},
      user_ip = #{record.userIp,jdbcType=VARCHAR},
      sql_type = #{record.sqlType,jdbcType=VARCHAR},
      fail = #{record.fail,jdbcType=VARCHAR},
      check_rows = #{record.checkRows,jdbcType=VARCHAR},
      update_rows = #{record.updateRows,jdbcType=VARCHAR},
      latency = #{record.latency,jdbcType=VARCHAR},
      ts = #{record.ts,jdbcType=VARCHAR}
    <if test="_parameter != null" >
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  
  <!-- 根据日期和类型查询CRM系统的访问日志 -->
  <select id="getSqlLogByDateAndType" resultType="hashmap" parameterType="hashmap">
  	<![CDATA[ 
  	SELECT 
  		CASE REPLACE(REPLACE(REPLACE(log,'\n',''),' ',''),'\t','')
				WHEN 'selecta.id,a.no,a.investorId,a.faId,a.name,a.mobile,b.createTimeregisterTime,a.source,b.registerSource,a.assignReasonType,c.nameadvisorName,c.mobileadvisorMobile,c.independent,b.riskName,a.documentNo,a.documentNoType,a.type,c.identifiedAuth,c.deptCode,a.authStatus,a.province,a.city,b.weixinName,a.gender,a.email,a.address,a.contactTime,a.age,a.birthday,a.profession,a.investAmount,a.intention,a.investmentPreference,a.bank,a.bankAcount,a.hobby,a.memo,a.appMemo,b.signNum,b.signAmount/10000signAmount,a.shareRegisterSourceTitle,a.shareRegisterSource,a.createTime,a.oldAdvisorName,a.oldAdvisorMobilefromwbs_customeraleftjoinwbs_investorbona.mobile=b.mobileleftjoinwbs_employeecona.faId=c.idwherea.entId=225anddeleted=0'
				THEN '客户导出'
				WHEN 'selectr.id,r.entId,r.ifaId,r.faId,r.status,r.createTime,r.contractNo,r.signAmount,r.categoryProperty,r.currency,r.reservationAmount,r.no,r.productName,r.reservationDate,r.customerName,r.mobile,r.deptCode,r.productId,r.signDate,r.performanceDate,c.documentNo,r.memo,r.reserveSource,d.namedeptName,d.parentCodeparentCode,r.payDate,r.valueDate,r.expiryDate,r.expectedReturn,r.exchangeRate,r.signAmountForeignCurrency,visit.reVisitFunc,visit.reVisitResult,r.investorId,r.customerId,p.termType,p.newTemplate,r.categoryId,r.categoryName,r.repayPlanStatus,caser.statuswhen-1thenr.acceptRejectTimeelser.acceptTimeendasacceptOrRejectTime,caser.statuswhen-1thenr.auditRejectTimeelser.auditTimeendasauditOrRejectTime,caser.statuswhen-1thenr.rejectTimeelser.signDateendassignOrRejectTimefromwbs_prd_reservationrleftjoinwbs_employeeeonr.faId=e.idleftjoinwbs_employeefonr.ifaId=f.idleftjoinwbs_customerconr.customerId=c.idleftjoinwbs_departmentdonr.deptCode=d.Codeleftjoinwbs_productponr.productId=p.idleftjoinwbs_prd_revisit_logvisitonr.id=visit.prdResvIdandvisit.id=(selectidfromwbs_prd_revisit_logvisitlogwherevisitlog.prdResvId=r.idandvisitlog.deleted=0orderbyvisitTimedesclimit1)wherer.entId=225andr.productSource!=3and(r.deleted&1!=1orr.deleted=0)orderbyr.updateTi'
				THEN '预约单导出'
				END `sql`,
  		`user`,user_ip userIp,check_rows checkRows,ts
  	]]>
	FROM wbs_sql_log
	where 1=1
	<if test='date != null and date != ""' >
        AND DATE(ts)=#{date}
     </if>
     <if test="type ==1" >
	     <![CDATA[ 
	     AND REPLACE(REPLACE(REPLACE(log,'\n',''),' ',''),'\t','') = 'selecta.id,a.no,a.investorId,a.faId,a.name,a.mobile,b.createTimeregisterTime,a.source,b.registerSource,a.assignReasonType,c.nameadvisorName,c.mobileadvisorMobile,c.independent,b.riskName,a.documentNo,a.documentNoType,a.type,c.identifiedAuth,c.deptCode,a.authStatus,a.province,a.city,b.weixinName,a.gender,a.email,a.address,a.contactTime,a.age,a.birthday,a.profession,a.investAmount,a.intention,a.investmentPreference,a.bank,a.bankAcount,a.hobby,a.memo,a.appMemo,b.signNum,b.signAmount/10000signAmount,a.shareRegisterSourceTitle,a.shareRegisterSource,a.createTime,a.oldAdvisorName,a.oldAdvisorMobilefromwbs_customeraleftjoinwbs_investorbona.mobile=b.mobileleftjoinwbs_employeecona.faId=c.idwherea.entId=225anddeleted=0'
	     ]]>
     </if>
     <if test="type ==2" >
	     <![CDATA[ 
	     AND REPLACE(REPLACE(REPLACE(log,'\n',''),' ',''),'\t','') = 'selectr.id,r.entId,r.ifaId,r.faId,r.status,r.createTime,r.contractNo,r.signAmount,r.categoryProperty,r.currency,r.reservationAmount,r.no,r.productName,r.reservationDate,r.customerName,r.mobile,r.deptCode,r.productId,r.signDate,r.performanceDate,c.documentNo,r.memo,r.reserveSource,d.namedeptName,d.parentCodeparentCode,r.payDate,r.valueDate,r.expiryDate,r.expectedReturn,r.exchangeRate,r.signAmountForeignCurrency,visit.reVisitFunc,visit.reVisitResult,r.investorId,r.customerId,p.termType,p.newTemplate,r.categoryId,r.categoryName,r.repayPlanStatus,caser.statuswhen-1thenr.acceptRejectTimeelser.acceptTimeendasacceptOrRejectTime,caser.statuswhen-1thenr.auditRejectTimeelser.auditTimeendasauditOrRejectTime,caser.statuswhen-1thenr.rejectTimeelser.signDateendassignOrRejectTimefromwbs_prd_reservationrleftjoinwbs_employeeeonr.faId=e.idleftjoinwbs_employeefonr.ifaId=f.idleftjoinwbs_customerconr.customerId=c.idleftjoinwbs_departmentdonr.deptCode=d.Codeleftjoinwbs_productponr.productId=p.idleftjoinwbs_prd_revisit_logvisitonr.id=visit.prdResvIdandvisit.id=(selectidfromwbs_prd_revisit_logvisitlogwherevisitlog.prdResvId=r.idandvisitlog.deleted=0orderbyvisitTimedesclimit1)wherer.entId=225andr.productSource!=3and(r.deleted&1!=1orr.deleted=0)orderbyr.updateTi'
	     ]]>
     </if>
     <if test="type !=1 and type !=2" >
	     <![CDATA[ 
	     AND REPLACE(REPLACE(REPLACE(log,'\n',''),' ',''),'\t','') IN('selecta.id,a.no,a.investorId,a.faId,a.name,a.mobile,b.createTimeregisterTime,a.source,b.registerSource,a.assignReasonType,c.nameadvisorName,c.mobileadvisorMobile,c.independent,b.riskName,a.documentNo,a.documentNoType,a.type,c.identifiedAuth,c.deptCode,a.authStatus,a.province,a.city,b.weixinName,a.gender,a.email,a.address,a.contactTime,a.age,a.birthday,a.profession,a.investAmount,a.intention,a.investmentPreference,a.bank,a.bankAcount,a.hobby,a.memo,a.appMemo,b.signNum,b.signAmount/10000signAmount,a.shareRegisterSourceTitle,a.shareRegisterSource,a.createTime,a.oldAdvisorName,a.oldAdvisorMobilefromwbs_customeraleftjoinwbs_investorbona.mobile=b.mobileleftjoinwbs_employeecona.faId=c.idwherea.entId=225anddeleted=0',
						'selectr.id,r.entId,r.ifaId,r.faId,r.status,r.createTime,r.contractNo,r.signAmount,r.categoryProperty,r.currency,r.reservationAmount,r.no,r.productName,r.reservationDate,r.customerName,r.mobile,r.deptCode,r.productId,r.signDate,r.performanceDate,c.documentNo,r.memo,r.reserveSource,d.namedeptName,d.parentCodeparentCode,r.payDate,r.valueDate,r.expiryDate,r.expectedReturn,r.exchangeRate,r.signAmountForeignCurrency,visit.reVisitFunc,visit.reVisitResult,r.investorId,r.customerId,p.termType,p.newTemplate,r.categoryId,r.categoryName,r.repayPlanStatus,caser.statuswhen-1thenr.acceptRejectTimeelser.acceptTimeendasacceptOrRejectTime,caser.statuswhen-1thenr.auditRejectTimeelser.auditTimeendasauditOrRejectTime,caser.statuswhen-1thenr.rejectTimeelser.signDateendassignOrRejectTimefromwbs_prd_reservationrleftjoinwbs_employeeeonr.faId=e.idleftjoinwbs_employeefonr.ifaId=f.idleftjoinwbs_customerconr.customerId=c.idleftjoinwbs_departmentdonr.deptCode=d.Codeleftjoinwbs_productponr.productId=p.idleftjoinwbs_prd_revisit_logvisitonr.id=visit.prdResvIdandvisit.id=(selectidfromwbs_prd_revisit_logvisitlogwherevisitlog.prdResvId=r.idandvisitlog.deleted=0orderbyvisitTimedesclimit1)wherer.entId=225andr.productSource!=3and(r.deleted&1!=1orr.deleted=0)orderbyr.updateTi')
	     ]]>
     </if>
     ORDER BY ts
     
  </select>
  <!-- 根据日期和类型查询CRM系统的访问日志数 -->
  <select id="countSqlLogByDateAndType" resultType="long" parameterType="hashmap">
	  	SELECT 
	  		count(1)
		FROM wbs_sql_log
		where 1=1
		<if test='date != null and date != ""' >
	        AND DATE(ts)=#{date}
	    </if>
	    <if test="type ==1" >
		     <![CDATA[ 
		     AND REPLACE(REPLACE(REPLACE(log,'\n',''),' ',''),'\t','') = 'selecta.id,a.no,a.investorId,a.faId,a.name,a.mobile,b.createTimeregisterTime,a.source,b.registerSource,a.assignReasonType,c.nameadvisorName,c.mobileadvisorMobile,c.independent,b.riskName,a.documentNo,a.documentNoType,a.type,c.identifiedAuth,c.deptCode,a.authStatus,a.province,a.city,b.weixinName,a.gender,a.email,a.address,a.contactTime,a.age,a.birthday,a.profession,a.investAmount,a.intention,a.investmentPreference,a.bank,a.bankAcount,a.hobby,a.memo,a.appMemo,b.signNum,b.signAmount/10000signAmount,a.shareRegisterSourceTitle,a.shareRegisterSource,a.createTime,a.oldAdvisorName,a.oldAdvisorMobilefromwbs_customeraleftjoinwbs_investorbona.mobile=b.mobileleftjoinwbs_employeecona.faId=c.idwherea.entId=225anddeleted=0'
		     ]]>
	    </if>
	    <if test="type ==2" >
		     <![CDATA[ 
		     AND REPLACE(REPLACE(REPLACE(log,'\n',''),' ',''),'\t','') = 'selectr.id,r.entId,r.ifaId,r.faId,r.status,r.createTime,r.contractNo,r.signAmount,r.categoryProperty,r.currency,r.reservationAmount,r.no,r.productName,r.reservationDate,r.customerName,r.mobile,r.deptCode,r.productId,r.signDate,r.performanceDate,c.documentNo,r.memo,r.reserveSource,d.namedeptName,d.parentCodeparentCode,r.payDate,r.valueDate,r.expiryDate,r.expectedReturn,r.exchangeRate,r.signAmountForeignCurrency,visit.reVisitFunc,visit.reVisitResult,r.investorId,r.customerId,p.termType,p.newTemplate,r.categoryId,r.categoryName,r.repayPlanStatus,caser.statuswhen-1thenr.acceptRejectTimeelser.acceptTimeendasacceptOrRejectTime,caser.statuswhen-1thenr.auditRejectTimeelser.auditTimeendasauditOrRejectTime,caser.statuswhen-1thenr.rejectTimeelser.signDateendassignOrRejectTimefromwbs_prd_reservationrleftjoinwbs_employeeeonr.faId=e.idleftjoinwbs_employeefonr.ifaId=f.idleftjoinwbs_customerconr.customerId=c.idleftjoinwbs_departmentdonr.deptCode=d.Codeleftjoinwbs_productponr.productId=p.idleftjoinwbs_prd_revisit_logvisitonr.id=visit.prdResvIdandvisit.id=(selectidfromwbs_prd_revisit_logvisitlogwherevisitlog.prdResvId=r.idandvisitlog.deleted=0orderbyvisitTimedesclimit1)wherer.entId=225andr.productSource!=3and(r.deleted&1!=1orr.deleted=0)orderbyr.updateTi'
		     ]]>
	     </if>
	     <if test="type !=1 and type !=2" >
		     <![CDATA[ 
		     AND REPLACE(REPLACE(REPLACE(log,'\n',''),' ',''),'\t','') IN('selecta.id,a.no,a.investorId,a.faId,a.name,a.mobile,b.createTimeregisterTime,a.source,b.registerSource,a.assignReasonType,c.nameadvisorName,c.mobileadvisorMobile,c.independent,b.riskName,a.documentNo,a.documentNoType,a.type,c.identifiedAuth,c.deptCode,a.authStatus,a.province,a.city,b.weixinName,a.gender,a.email,a.address,a.contactTime,a.age,a.birthday,a.profession,a.investAmount,a.intention,a.investmentPreference,a.bank,a.bankAcount,a.hobby,a.memo,a.appMemo,b.signNum,b.signAmount/10000signAmount,a.shareRegisterSourceTitle,a.shareRegisterSource,a.createTime,a.oldAdvisorName,a.oldAdvisorMobilefromwbs_customeraleftjoinwbs_investorbona.mobile=b.mobileleftjoinwbs_employeecona.faId=c.idwherea.entId=225anddeleted=0',
							'selectr.id,r.entId,r.ifaId,r.faId,r.status,r.createTime,r.contractNo,r.signAmount,r.categoryProperty,r.currency,r.reservationAmount,r.no,r.productName,r.reservationDate,r.customerName,r.mobile,r.deptCode,r.productId,r.signDate,r.performanceDate,c.documentNo,r.memo,r.reserveSource,d.namedeptName,d.parentCodeparentCode,r.payDate,r.valueDate,r.expiryDate,r.expectedReturn,r.exchangeRate,r.signAmountForeignCurrency,visit.reVisitFunc,visit.reVisitResult,r.investorId,r.customerId,p.termType,p.newTemplate,r.categoryId,r.categoryName,r.repayPlanStatus,caser.statuswhen-1thenr.acceptRejectTimeelser.acceptTimeendasacceptOrRejectTime,caser.statuswhen-1thenr.auditRejectTimeelser.auditTimeendasauditOrRejectTime,caser.statuswhen-1thenr.rejectTimeelser.signDateendassignOrRejectTimefromwbs_prd_reservationrleftjoinwbs_employeeeonr.faId=e.idleftjoinwbs_employeefonr.ifaId=f.idleftjoinwbs_customerconr.customerId=c.idleftjoinwbs_departmentdonr.deptCode=d.Codeleftjoinwbs_productponr.productId=p.idleftjoinwbs_prd_revisit_logvisitonr.id=visit.prdResvIdandvisit.id=(selectidfromwbs_prd_revisit_logvisitlogwherevisitlog.prdResvId=r.idandvisitlog.deleted=0orderbyvisitTimedesclimit1)wherer.entId=225andr.productSource!=3and(r.deleted&1!=1orr.deleted=0)orderbyr.updateTi')
		     ]]>
     	</if>
  </select>
</mapper>